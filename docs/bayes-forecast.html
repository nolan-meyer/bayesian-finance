<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Bayes Forecast | Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies</title>
  <meta name="description" content="Bayesian Statistics Capstone Project" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Bayes Forecast | Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Bayesian Statistics Capstone Project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Bayes Forecast | Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies" />
  
  <meta name="twitter:description" content="Bayesian Statistics Capstone Project" />
  

<meta name="author" content="Nicholas Di, Nolan Meyer, Duc Ngo" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hierarchical-modeling.html"/>
<link rel="next" href="finalmodel.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 454 Capstone</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#data-source"><i class="fa fa-check"></i><b>2.1</b> Data Source</a></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#variables"><i class="fa fa-check"></i><b>2.2</b> Variables</a></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#data-cleaning"><i class="fa fa-check"></i><b>2.3</b> Data Cleaning</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data.html"><a href="data.html#data-pre-processing"><i class="fa fa-check"></i><b>2.3.1</b> Data Pre-Processing</a></li>
<li class="chapter" data-level="2.3.2" data-path="data.html"><a href="data.html#graphing-outliers"><i class="fa fa-check"></i><b>2.3.2</b> Graphing Outliers</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data.html"><a href="data.html#initial-explorations"><i class="fa fa-check"></i><b>2.4</b> Initial Explorations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html"><i class="fa fa-check"></i><b>3</b> Hierarchical Modeling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#set-up"><i class="fa fa-check"></i><b>3.1</b> Set Up</a></li>
<li class="chapter" data-level="3.2" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-1-hierarchical-w-different-intercepts"><i class="fa fa-check"></i><b>3.2</b> Model 1: Hierarchical w/ Different Intercepts</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-structure"><i class="fa fa-check"></i><b>3.2.1</b> Model Structure</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-2-hierarchical-w-different-slopes-and-intercepts"><i class="fa fa-check"></i><b>3.3</b> Model 2: Hierarchical w/ Different Slopes and Intercepts</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-structure-1"><i class="fa fa-check"></i><b>3.3.1</b> Model Structure</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-evaluations"><i class="fa fa-check"></i><b>3.4</b> Model Evaluations</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#is-this-the-right-model"><i class="fa fa-check"></i><b>3.4.1</b> Is this the right model?</a></li>
<li class="chapter" data-level="3.4.2" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#how-accurate-are-the-models"><i class="fa fa-check"></i><b>3.4.2</b> How Accurate are the models?</a></li>
<li class="chapter" data-level="3.4.3" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#interpreting-coefficents"><i class="fa fa-check"></i><b>3.4.3</b> Interpreting Coefficents</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bayes-forecast.html"><a href="bayes-forecast.html"><i class="fa fa-check"></i><b>4</b> Bayes Forecast</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bayes-forecast.html"><a href="bayes-forecast.html#model-parameters"><i class="fa fa-check"></i><b>4.1</b> Model Parameters</a></li>
<li class="chapter" data-level="4.2" data-path="bayes-forecast.html"><a href="bayes-forecast.html#modeling"><i class="fa fa-check"></i><b>4.2</b> Modeling</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="bayes-forecast.html"><a href="bayes-forecast.html#accuracy"><i class="fa fa-check"></i><b>4.2.1</b> Accuracy</a></li>
<li class="chapter" data-level="4.2.2" data-path="bayes-forecast.html"><a href="bayes-forecast.html#company-predictions"><i class="fa fa-check"></i><b>4.2.2</b> Company Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finalmodel.html"><a href="finalmodel.html"><i class="fa fa-check"></i><b>5</b> Final Model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finalmodel.html"><a href="finalmodel.html#model-structure-2"><i class="fa fa-check"></i><b>5.1</b> Model Structure</a></li>
<li class="chapter" data-level="5.2" data-path="finalmodel.html"><a href="finalmodel.html#model-evaluation"><i class="fa fa-check"></i><b>5.2</b> Model Evaluation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="finalmodel.html"><a href="finalmodel.html#diagnostic-plots"><i class="fa fa-check"></i><b>5.2.1</b> Diagnostic Plots</a></li>
<li class="chapter" data-level="5.2.2" data-path="finalmodel.html"><a href="finalmodel.html#metrics"><i class="fa fa-check"></i><b>5.2.2</b> Metrics</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="finalmodel.html"><a href="finalmodel.html#summary"><i class="fa fa-check"></i><b>5.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reflection.html"><a href="reflection.html"><i class="fa fa-check"></i><b>6</b> Reflection</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reflection.html"><a href="reflection.html#next-steps"><i class="fa fa-check"></i><b>6.1</b> Next Steps</a></li>
<li class="chapter" data-level="6.2" data-path="reflection.html"><a href="reflection.html#acknowledgements"><i class="fa fa-check"></i><b>6.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="6.3" data-path="reflection.html"><a href="reflection.html#citations"><i class="fa fa-check"></i><b>6.3</b> Citations</a></li>
<li class="chapter" data-level="6.4" data-path="reflection.html"><a href="reflection.html#code-appendix"><i class="fa fa-check"></i><b>6.4</b> Code Appendix</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayes-forecast" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Bayes Forecast</h1>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="bayes-forecast.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesforecast)</span></code></pre></div>
<p><strong>Bayesian Forecast SARIMA:</strong></p>
<p>In our last model specification, we decided to use the bayesforecast package. In particular we are fitting a SARIMA model in Stan.</p>
<p>SARIMA stands for seasonal auto-regressive integrated moving average. This is an extension of ARIMA and is therefore more robust as it is able to support seasonal data.</p>
<p>ARIMA is a method that combines both auto-regressive methods and moving averages- it is widely used on time series data in attempts to predict future values. There are four components that explain time series data, trend, seasonality, irregularity, and cyclic components.</p>
<p><strong>Reason to use Bayesian forecast:</strong></p>
<p>The reason that we are using Bayesian forecast is that it accounts for seasonal order, trends, or seasonality, which could help make the model more accurate. Moreover, Bayesian Forecast can also automate the process within the stan_sarima and auto_arima, in which the model will see which order, seasonal, or trend, fits with certain companies and variables.</p>
<p>For Bayesian Forecast, we will first try to see the accuracy rate of the model compared to our complex hierarchical model. After that, using Bayesian Forecast, we will try to see what are the predicted earnings after ten years for Amazon (symbol: “AMZN”) and American Airlines (symbol: “AAL”).</p>
<div id="model-parameters" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Model Parameters</h2>
<p>Here are the parameters for an ARIMA model:</p>
<p>P - Order of the AR term. This is the number of Y to be used as predictors. For example, if we are predicting 2021 earnings, how many previous years earnings are we going to use?</p>
<p>Q - Order of the MA term. This is the number of lagged forecast errors. How many past forecast errors will we be using?</p>
<p>D - The minimum differencing period. A stationary time series implies one that has properties that do not depend on the time at which the series is observed.</p>
<p>As mentioned above, SARIMA is able to support seasonal data. Below are the parameters for a SARIMA model that ARIMA does not have.</p>
<p>P - Seasonal auto-regressive order. A P=1 would make use of the first seasonally offset observation in the model, e.g. t-(m1) or t-12. A P=2, would use the last two seasonally offset observations t-(m1), t-(m2).</p>
<p>D - Seasonal difference order. A D of 1 would calculate a first order seasonal difference and a Q=1 would use a first order error in the model (e.g. moving average).</p>
<p>Q - Seasonal moving average order.</p>
<p>M - The number of time steps for a single seasonal period. M is a very important parameter as it influences the P, D, and Q parameters. For example, an m of 5 for yearly data suggests a 5-year seasonal cycle (in the context of business cycles.</p>
<p><strong>Model Tuning</strong></p>
<p>For the model we will use the default stan_sarima model in order to predict the earnings for the company. The reason for that is because for each company, it will have different order, seasonal and period. Manually picking the order and seasonal for each company might result in large errors as each company belongs in different fields, different sectors and also have different stories. Manually picking each company might result in a lot of inaccuracies.</p>
<p>As we chose the default prior for the companies, it will assume that each company will have a prior normal function for the moving average and auto-regressive parameters. Additionally, the auto-regressive parameters and moving averages will have the same normal function of N(0,0.5)</p>
</div>
<div id="modeling" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Modeling</h2>
<div id="accuracy" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Accuracy</h3>
<p>In order to predict next year’s earnings for every company, as it acts like a time series model, we need to have companies that have at least 3 years of earnings. We first eliminate the companies that have only 2 years of earnings in this dataset, then we will create a function to find the earnings for the next year of these companies.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="bayes-forecast.html#cb42-1" aria-hidden="true" tabindex="-1"></a>COMPANY_Names <span class="ot">&lt;-</span> data_elimatedO<span class="sc">$</span>COMPANY</span>
<span id="cb42-2"><a href="bayes-forecast.html#cb42-2" aria-hidden="true" tabindex="-1"></a>unique_COMPANY <span class="ot">&lt;-</span> <span class="fu">unique</span>(COMPANY_Names)</span>
<span id="cb42-3"><a href="bayes-forecast.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="bayes-forecast.html#cb42-4" aria-hidden="true" tabindex="-1"></a>unique_COMPANY</span>
<span id="cb42-5"><a href="bayes-forecast.html#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="bayes-forecast.html#cb42-6" aria-hidden="true" tabindex="-1"></a>data_elimatedO <span class="sc">%&gt;%</span> </span>
<span id="cb42-7"><a href="bayes-forecast.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COMPANY) <span class="sc">%&gt;%</span> </span>
<span id="cb42-8"><a href="bayes-forecast.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb42-9"><a href="bayes-forecast.html#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&lt;=</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="bayes-forecast.html#cb43-1" aria-hidden="true" tabindex="-1"></a>unique_COMPANY_2 <span class="ot">&lt;-</span>unique_COMPANY</span>
<span id="cb43-2"><a href="bayes-forecast.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="bayes-forecast.html#cb43-3" aria-hidden="true" tabindex="-1"></a>unique_COMPANY_2 <span class="ot">=</span> unique_COMPANY_2[<span class="fu">factor</span>(unique_COMPANY_2) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ABBV&quot;</span>,<span class="st">&quot;AMCR&quot;</span> ,<span class="st">&quot;BAC&quot;</span>  ,<span class="st">&quot;CARR&quot;</span>, <span class="st">&quot;CTVA&quot;</span>,  <span class="st">&quot;DOW&quot;</span>,   <span class="st">&quot;FB&quot;</span>, <span class="st">&quot;GOOG&quot;</span>,  <span class="st">&quot;GOOGL&quot;</span>, <span class="st">&quot;INTC&quot;</span>,  <span class="st">&quot;JNJ&quot;</span>, <span class="st">&quot;OTIS&quot;</span>, <span class="st">&quot;PSX&quot;</span>, <span class="st">&quot;FOX&quot;</span>, <span class="st">&quot;FOXA&quot;</span>, <span class="st">&quot;HD&quot;</span>, <span class="st">&quot;KHC&quot;</span>, <span class="st">&quot;LYB&quot;</span>, <span class="st">&quot;MDLZ&quot;</span>, <span class="st">&quot;MRK&quot;</span>, <span class="st">&quot;MRNA&quot;</span>, <span class="st">&quot;OTIS&quot;</span>, <span class="st">&quot;PEP&quot;</span>, <span class="st">&quot;JPM&quot;</span>) <span class="sc">==</span> <span class="cn">FALSE</span>] </span>
<span id="cb43-4"><a href="bayes-forecast.html#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="bayes-forecast.html#cb43-5" aria-hidden="true" tabindex="-1"></a>total_number_of_COMPANY <span class="ot">&lt;-</span> <span class="fu">length</span>(unique_COMPANY)</span>
<span id="cb43-6"><a href="bayes-forecast.html#cb43-6" aria-hidden="true" tabindex="-1"></a>total_number_of_COMPANY_2 <span class="ot">&lt;-</span> <span class="fu">length</span>(unique_COMPANY_2)</span></code></pre></div>
<p>After finding all of the desirable companies, we are left with 464 companies. We then created a function in order to predict the earnings next year for these 464 companies using Bayesian Forecast:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="bayes-forecast.html#cb44-1" aria-hidden="true" tabindex="-1"></a>point <span class="ot">&lt;-</span> high <span class="ot">&lt;-</span> low <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">464</span>)</span>
<span id="cb44-2"><a href="bayes-forecast.html#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="bayes-forecast.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span> total_number_of_COMPANY_2) {</span>
<span id="cb44-4"><a href="bayes-forecast.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  company <span class="ot">&lt;-</span> unique_COMPANY_2[i]</span>
<span id="cb44-5"><a href="bayes-forecast.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-6"><a href="bayes-forecast.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  data_new <span class="ot">&lt;-</span> data_elimatedO <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="bayes-forecast.html#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(COMPANY <span class="sc">==</span> company) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="bayes-forecast.html#cb44-8" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(EARNINGS_Scaled, YEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="bayes-forecast.html#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">min_year =</span> <span class="fu">min</span>(YEAR), </span>
<span id="cb44-10"><a href="bayes-forecast.html#cb44-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">max_year =</span> <span class="fu">max</span>(YEAR)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-11"><a href="bayes-forecast.html#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(EARNINGS_Scaled)</span>
<span id="cb44-12"><a href="bayes-forecast.html#cb44-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-13"><a href="bayes-forecast.html#cb44-13" aria-hidden="true" tabindex="-1"></a>  min_year <span class="ot">&lt;-</span> data_new<span class="sc">$</span>min_year[<span class="dv">1</span>]</span>
<span id="cb44-14"><a href="bayes-forecast.html#cb44-14" aria-hidden="true" tabindex="-1"></a>  max_year <span class="ot">&lt;-</span> data_new<span class="sc">$</span>max_year[<span class="dv">1</span>]</span>
<span id="cb44-15"><a href="bayes-forecast.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="bayes-forecast.html#cb44-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-17"><a href="bayes-forecast.html#cb44-17" aria-hidden="true" tabindex="-1"></a>  vector <span class="ot">&lt;-</span> data_new<span class="sc">$</span>EARNINGS_Scaled</span>
<span id="cb44-18"><a href="bayes-forecast.html#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="bayes-forecast.html#cb44-19" aria-hidden="true" tabindex="-1"></a>  myts <span class="ot">&lt;-</span> <span class="fu">ts</span>(vector, <span class="at">start=</span><span class="fu">c</span>(min_year), <span class="at">end=</span><span class="fu">c</span>(max_year), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb44-20"><a href="bayes-forecast.html#cb44-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-21"><a href="bayes-forecast.html#cb44-21" aria-hidden="true" tabindex="-1"></a>  sf1 <span class="ot">=</span> <span class="fu">stan_sarima</span>(<span class="at">ts =</span> myts, <span class="at">iter =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5000</span>)</span>
<span id="cb44-22"><a href="bayes-forecast.html#cb44-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-23"><a href="bayes-forecast.html#cb44-23" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">forecast</span>(<span class="at">object =</span> sf1,<span class="at">h =</span> <span class="dv">1</span>)</span>
<span id="cb44-24"><a href="bayes-forecast.html#cb44-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-25"><a href="bayes-forecast.html#cb44-25" aria-hidden="true" tabindex="-1"></a>  point[i] <span class="ot">&lt;-</span> result<span class="sc">$</span>mean</span>
<span id="cb44-26"><a href="bayes-forecast.html#cb44-26" aria-hidden="true" tabindex="-1"></a>  low[i] <span class="ot">&lt;-</span> result<span class="sc">$</span>lower[<span class="dv">2</span>]</span>
<span id="cb44-27"><a href="bayes-forecast.html#cb44-27" aria-hidden="true" tabindex="-1"></a>  high[i] <span class="ot">&lt;-</span> result<span class="sc">$</span>upper[<span class="dv">2</span>]</span>
<span id="cb44-28"><a href="bayes-forecast.html#cb44-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-29"><a href="bayes-forecast.html#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="bayes-forecast.html#cb44-30" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(unique_COMPANY_2[<span class="dv">1</span><span class="sc">:</span> total_number_of_COMPANY_2], point, low, high)</span>
<span id="cb44-31"><a href="bayes-forecast.html#cb44-31" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<p>After having the dataset, we then combine the function with the actual dataset in order to see the accuracy rate for these models in which it predicts the earnings next year for these companies.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="bayes-forecast.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) </span>
<span id="cb45-2"><a href="bayes-forecast.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="bayes-forecast.html#cb45-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="bayes-forecast.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">COMPANY =</span> <span class="st">`</span><span class="at">unique_COMPANY_2.1.total_number_of_COMPANY_2.</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="bayes-forecast.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span> <span class="st">`</span><span class="at">unique_COMPANY_2.1.total_number_of_COMPANY_2.</span><span class="st">`</span>)</span>
<span id="cb45-6"><a href="bayes-forecast.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="bayes-forecast.html#cb45-7" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">&lt;-</span> data_elimatedO <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="bayes-forecast.html#cb45-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(COMPANY) <span class="sc">%&gt;%</span> </span>
<span id="cb45-9"><a href="bayes-forecast.html#cb45-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb45-10"><a href="bayes-forecast.html#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="bayes-forecast.html#cb45-11" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(data_elimatedO, testing)</span>
<span id="cb45-12"><a href="bayes-forecast.html#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="bayes-forecast.html#cb45-13" aria-hidden="true" tabindex="-1"></a>testing</span>
<span id="cb45-14"><a href="bayes-forecast.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="bayes-forecast.html#cb45-15" aria-hidden="true" tabindex="-1"></a>bayesian_forecast_earnigns <span class="ot">=</span> <span class="fu">merge</span>(<span class="at">x =</span> df, <span class="at">y =</span> testing, <span class="at">by =</span> <span class="st">&quot;COMPANY&quot;</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-16"><a href="bayes-forecast.html#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="bayes-forecast.html#cb45-17" aria-hidden="true" tabindex="-1"></a>bayesian_forecast_earnigns</span>
<span id="cb45-18"><a href="bayes-forecast.html#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="bayes-forecast.html#cb45-19" aria-hidden="true" tabindex="-1"></a>bayesian_forecast_earnigns <span class="ot">&lt;-</span> bayesian_forecast_earnigns <span class="sc">%&gt;%</span> </span>
<span id="cb45-20"><a href="bayes-forecast.html#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(COMPANY, point, low, high, YEAR, Earnings_next_year_Scaled)</span>
<span id="cb45-21"><a href="bayes-forecast.html#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="bayes-forecast.html#cb45-22" aria-hidden="true" tabindex="-1"></a>bayesian_forecast_earnigns</span>
<span id="cb45-23"><a href="bayes-forecast.html#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="bayes-forecast.html#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(bayesian_forecast_earnigns, <span class="st">&quot;bayesian_forecast_earnigns.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="bayes-forecast.html#cb46-1" aria-hidden="true" tabindex="-1"></a>bayesian_forecast_earnigns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;bayesian_forecast_earnigns.csv&quot;</span>)</span></code></pre></div>
<p>After combining the two datasets, we then evaluate the accuracy rate for the Bayesian forecast model:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="bayes-forecast.html#cb47-1" aria-hidden="true" tabindex="-1"></a>bayesian_forecast_earnigns <span class="ot">&lt;-</span> bayesian_forecast_earnigns <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="bayes-forecast.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_dist =</span> <span class="fu">abs</span>(point <span class="sc">-</span> Earnings_next_year_Scaled)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="bayes-forecast.html#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Is_90 =</span> (Earnings_next_year_Scaled <span class="sc">&gt;=</span> low) <span class="sc">&amp;</span> (Earnings_next_year_Scaled <span class="sc">&lt;=</span> high))</span>
<span id="cb47-4"><a href="bayes-forecast.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="bayes-forecast.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bayesian_forecast_earnigns<span class="sc">$</span>median_dist)</span></code></pre></div>
<pre><code>## [1] 0.6589985</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="bayes-forecast.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bayesian_forecast_earnigns<span class="sc">$</span>Is_90)</span></code></pre></div>
<pre><code>## [1] 0.5150862</code></pre>
<p>Overall, as we can see, the accuracy is not really high. The distance from the median is 0.6589, which shows that a company’s earnings will be off by around 0.6589 billions, which is a fairly high number. Moreover, only 51.5% of the companies is within the 90% percentile, which is a relatively small number. Overall, the model performs worse than the hierarchical model on section 3.</p>
</div>
<div id="company-predictions" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Company Predictions</h3>
<p>After creating the model, we will then move on to predict the earnings of the future year for the companies. The companies we are going to predict will be Amazon (symbol: “AMZN”) and American Airlines (symbol: “AAL”).</p>
<p><strong>Amazon Prediction</strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="bayes-forecast.html#cb51-1" aria-hidden="true" tabindex="-1"></a>AMZN <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="bayes-forecast.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COMPANY <span class="sc">==</span> <span class="st">&#39;AMZN&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="bayes-forecast.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(EARNINGS_Scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="bayes-forecast.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EARNINGS_Scaled)</span>
<span id="cb51-5"><a href="bayes-forecast.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="bayes-forecast.html#cb51-6" aria-hidden="true" tabindex="-1"></a>vector <span class="ot">&lt;-</span> AMZN<span class="sc">$</span>EARNINGS_Scaled</span>
<span id="cb51-7"><a href="bayes-forecast.html#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="bayes-forecast.html#cb51-8" aria-hidden="true" tabindex="-1"></a>myts <span class="ot">&lt;-</span> <span class="fu">ts</span>(vector, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1999</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2021</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb51-9"><a href="bayes-forecast.html#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="bayes-forecast.html#cb51-10" aria-hidden="true" tabindex="-1"></a>sf1 <span class="ot">=</span> <span class="fu">stan_sarima</span>(<span class="at">ts =</span> myts,<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">seasonal =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb51-11"><a href="bayes-forecast.html#cb51-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">prior_mu0 =</span> <span class="fu">student</span>(<span class="at">mu =</span> <span class="dv">0</span>,<span class="at">sd =</span> <span class="dv">1</span>,<span class="at">df =</span> <span class="dv">7</span>), <span class="at">iter =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="bayes-forecast.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(<span class="at">object =</span> sf1, <span class="at">h =</span> <span class="dv">12</span>))</span></code></pre></div>
<p><img src="series_files/figure-html/fig3-1.png" width="672" /></p>
<p>First, for Amazon, we see that the earnings are predicted to increase from 2021 to 2030, moving from 21 billion to around 38 billion in 2030. However, we can see that the prediction states that the earnings growth tends to slow down over time over the period.</p>
<p><strong>American Airlines Prediction</strong></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="bayes-forecast.html#cb53-1" aria-hidden="true" tabindex="-1"></a>AAL <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="bayes-forecast.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COMPANY <span class="sc">==</span> <span class="st">&#39;AAL&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="bayes-forecast.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(EARNINGS_Scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="bayes-forecast.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(EARNINGS_Scaled)</span>
<span id="cb53-5"><a href="bayes-forecast.html#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="bayes-forecast.html#cb53-6" aria-hidden="true" tabindex="-1"></a>vector <span class="ot">&lt;-</span> AAL<span class="sc">$</span>EARNINGS_Scaled</span>
<span id="cb53-7"><a href="bayes-forecast.html#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="bayes-forecast.html#cb53-8" aria-hidden="true" tabindex="-1"></a>myts <span class="ot">&lt;-</span> <span class="fu">ts</span>(vector, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1999</span>), <span class="at">end=</span><span class="fu">c</span>(<span class="dv">2021</span>), <span class="at">frequency=</span><span class="dv">1</span>)</span>
<span id="cb53-9"><a href="bayes-forecast.html#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="bayes-forecast.html#cb53-10" aria-hidden="true" tabindex="-1"></a>sf1 <span class="ot">=</span> <span class="fu">stan_sarima</span>(<span class="at">ts =</span> myts,<span class="at">iter =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">5000</span>)</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="bayes-forecast.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_residuals</span>(sf1)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="bayes-forecast.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">forecast</span>(<span class="at">object =</span> sf1, <span class="at">h =</span> <span class="dv">12</span>))</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-51-2.png" width="672" /></p>
<p>For American Airlines, we see a different story. As we can see from the graph, as airlines industry is an extremely cyclical field, the earnings fluctuate a lot. We could see that they fluctuate a lot during the previous years. With that in mind, the model predicts that American Airlines will not improve the much during the following years from 2021 to 2030 as predicting a cyclical company’s earnings could be a really difficult story. It did not show the similar pattern as Amazon.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hierarchical-modeling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="finalmodel.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
