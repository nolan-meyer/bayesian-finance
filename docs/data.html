<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Data | Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies</title>
  <meta name="description" content="Bayesian Statistics Capstone Project" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Data | Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Bayesian Statistics Capstone Project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Data | Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies" />
  
  <meta name="twitter:description" content="Bayesian Statistics Capstone Project" />
  

<meta name="author" content="Nicholas Di, Nolan Meyer, Duc Ngo" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="hierarchical-modeling.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">STAT 454 Capstone</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#data-source"><i class="fa fa-check"></i><b>2.1</b> Data Source</a></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#variables"><i class="fa fa-check"></i><b>2.2</b> Variables</a></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#data-cleaning"><i class="fa fa-check"></i><b>2.3</b> Data Cleaning</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data.html"><a href="data.html#data-pre-processing"><i class="fa fa-check"></i><b>2.3.1</b> Data Pre-Processing</a></li>
<li class="chapter" data-level="2.3.2" data-path="data.html"><a href="data.html#graphing-outliers"><i class="fa fa-check"></i><b>2.3.2</b> Graphing Outliers</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data.html"><a href="data.html#initial-explorations"><i class="fa fa-check"></i><b>2.4</b> Initial Explorations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html"><i class="fa fa-check"></i><b>3</b> Hierarchical Modeling</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#set-up"><i class="fa fa-check"></i><b>3.1</b> Set Up</a></li>
<li class="chapter" data-level="3.2" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-1-hierarchical-w-different-intercepts"><i class="fa fa-check"></i><b>3.2</b> Model 1: Hierarchical w/ Different Intercepts</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-structure"><i class="fa fa-check"></i><b>3.2.1</b> Model Structure</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-2-hierarchical-w-different-slopes-and-intercepts"><i class="fa fa-check"></i><b>3.3</b> Model 2: Hierarchical w/ Different Slopes and Intercepts</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-structure-1"><i class="fa fa-check"></i><b>3.3.1</b> Model Structure</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#model-evaluations"><i class="fa fa-check"></i><b>3.4</b> Model Evaluations</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#is-this-the-right-model"><i class="fa fa-check"></i><b>3.4.1</b> Is this the right model?</a></li>
<li class="chapter" data-level="3.4.2" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#how-accurate-are-the-models"><i class="fa fa-check"></i><b>3.4.2</b> How Accurate are the models?</a></li>
<li class="chapter" data-level="3.4.3" data-path="hierarchical-modeling.html"><a href="hierarchical-modeling.html#interpreting-coefficents"><i class="fa fa-check"></i><b>3.4.3</b> Interpreting Coefficents</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bayes-forecast.html"><a href="bayes-forecast.html"><i class="fa fa-check"></i><b>4</b> Bayes Forecast</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bayes-forecast.html"><a href="bayes-forecast.html#model-parameters"><i class="fa fa-check"></i><b>4.1</b> Model Parameters</a></li>
<li class="chapter" data-level="4.2" data-path="bayes-forecast.html"><a href="bayes-forecast.html#modeling"><i class="fa fa-check"></i><b>4.2</b> Modeling</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finalmodel.html"><a href="finalmodel.html"><i class="fa fa-check"></i><b>5</b> Final Model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finalmodel.html"><a href="finalmodel.html#model-structure-2"><i class="fa fa-check"></i><b>5.1</b> Model Structure</a></li>
<li class="chapter" data-level="5.2" data-path="finalmodel.html"><a href="finalmodel.html#model-evaluation"><i class="fa fa-check"></i><b>5.2</b> Model Evaluation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="finalmodel.html"><a href="finalmodel.html#diagnostic-plots"><i class="fa fa-check"></i><b>5.2.1</b> Diagnostic Plots</a></li>
<li class="chapter" data-level="5.2.2" data-path="finalmodel.html"><a href="finalmodel.html#metrics"><i class="fa fa-check"></i><b>5.2.2</b> Metrics</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="finalmodel.html"><a href="finalmodel.html#summary"><i class="fa fa-check"></i><b>5.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reflection.html"><a href="reflection.html"><i class="fa fa-check"></i><b>6</b> Reflection</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reflection.html"><a href="reflection.html#next-steps"><i class="fa fa-check"></i><b>6.1</b> Next Steps</a></li>
<li class="chapter" data-level="6.2" data-path="reflection.html"><a href="reflection.html#acknowledgements"><i class="fa fa-check"></i><b>6.2</b> Acknowledgements</a></li>
<li class="chapter" data-level="6.3" data-path="reflection.html"><a href="reflection.html#citations"><i class="fa fa-check"></i><b>6.3</b> Citations</a></li>
<li class="chapter" data-level="6.4" data-path="reflection.html"><a href="reflection.html#code-appendix"><i class="fa fa-check"></i><b>6.4</b> Code Appendix</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Finance: Modeling Earnings for S&amp;P 500 Companies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Data</h1>
<div id="data-source" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Data Source</h2>
<p>Our data includes financial information on companies in the S&amp;P 500 stock index from 1999-2021. This information was scraped from Yahoo Finance in November of 2021, and collected in a csv format for data analysis.</p>
<p>To collect the data, first, we got the list of the current 500 S&amp;P companies from Slickchart (<a href="https://www.slickcharts.com/sp500" class="uri">https://www.slickcharts.com/sp500</a>). After having the list of the companies, we then moved on to the financials information of the listed companies on yahoo finance (<a href="https://finance.yahoo.com/" class="uri">https://finance.yahoo.com/</a>) to get the metrics such as sales, earnings, cogs, stock price, and market sector. We then scraped the data using BeautifulSoup library in Python and turned that into a CSV file.</p>
<p>After getting the data, our main goal is to analyze and model this data to better improve projections for a company’s future metrics, like earnings.</p>
</div>
<div id="variables" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Variables</h2>
<p>The main variables that are used in this project are defined below:</p>
<table>
<colgroup>
<col width="16%" />
<col width="83%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>YEAR</td>
<td>The financial year of the company</td>
</tr>
<tr class="even">
<td>COMPANY</td>
<td>The company’s stock abbreviation symbol</td>
</tr>
<tr class="odd">
<td>MARKET.CAP</td>
<td>The total market capitalization of the company (Volume * Price)</td>
</tr>
<tr class="even">
<td>EARNINGS</td>
<td>The earnings in dollars for the previous year for the given company</td>
</tr>
<tr class="odd">
<td>SALES</td>
<td>How much the company sold in dollars last year</td>
</tr>
<tr class="even">
<td>CASH</td>
<td>How much cash the company has in dollars at the end of the previous year</td>
</tr>
<tr class="odd">
<td>Name</td>
<td>The full name of the company</td>
</tr>
<tr class="even">
<td>Sector</td>
<td>The name of the sector that the company is a part of</td>
</tr>
<tr class="odd">
<td>Earnings_next_year</td>
<td>The amount of money in dollars that the company earns in the following year</td>
</tr>
<tr class="even">
<td>EARNINGS_1_YEAR_AGO</td>
<td>The amount of money in dollars that the company earned in the previous year</td>
</tr>
</tbody>
</table>
</div>
<div id="data-cleaning" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Data Cleaning</h2>
<div id="data-pre-processing" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Data Pre-Processing</h3>
<p>First, as the earnings, cash and other variables are really large, we have decided to divide them by 1 billion. The reason for that is to make it easier to interpret and to understand the model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling Variables of Interest</span></span>
<span id="cb1-2"><a href="data.html#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="data.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EARNINGS_Scaled =</span> EARNINGS<span class="sc">/</span><span class="dv">1000000000</span>,</span>
<span id="cb1-4"><a href="data.html#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">CASH_Scaled =</span> CASH<span class="sc">/</span><span class="dv">1000000000</span>,</span>
<span id="cb1-5"><a href="data.html#cb1-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">MARKET.CAP_Scaled =</span> MARKET.CAP<span class="sc">/</span><span class="dv">1000000000</span>,</span>
<span id="cb1-6"><a href="data.html#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Earnings_next_year_Scaled =</span> Earnings_next_year<span class="sc">/</span><span class="dv">1000000000</span>,</span>
<span id="cb1-7"><a href="data.html#cb1-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">SALES_Scaled =</span> SALES<span class="sc">/</span><span class="dv">1000000000</span>)</span></code></pre></div>
<p>Next, we added lagged variables for earnings and sales as we believe information from previous years will help predict future metrics.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding Lagged Variables</span></span>
<span id="cb2-2"><a href="data.html#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="data.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COMPANY) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="data.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EARNINGS_1_YEAR_AGO =</span> <span class="fu">lead</span>(EARNINGS_Scaled, <span class="at">n =</span> <span class="dv">1</span>), </span>
<span id="cb2-5"><a href="data.html#cb2-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">EARNINGS_2_YEAR_AGO =</span> <span class="fu">lead</span>(EARNINGS_Scaled, <span class="at">n =</span> <span class="dv">2</span>),</span>
<span id="cb2-6"><a href="data.html#cb2-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">EARNINGS_3_YEAR_AGO =</span> <span class="fu">lead</span>(EARNINGS_Scaled, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb2-7"><a href="data.html#cb2-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">EARNINGS_4_YEAR_AGO =</span> <span class="fu">lead</span>(EARNINGS_Scaled, <span class="at">n =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-8"><a href="data.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SALES_1_YEAR_AGO =</span> <span class="fu">lead</span>(SALES_Scaled, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb2-9"><a href="data.html#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">SALES_2_YEAR_AGO =</span> <span class="fu">lead</span>(SALES_Scaled, <span class="at">n =</span> <span class="dv">2</span>),</span>
<span id="cb2-10"><a href="data.html#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">SALES_3_YEAR_AGO =</span> <span class="fu">lead</span>(SALES_Scaled, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb2-11"><a href="data.html#cb2-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">SALES_4_YEAR_AGO =</span> <span class="fu">lead</span>(SALES_Scaled, <span class="at">n =</span> <span class="dv">4</span>))</span></code></pre></div>
</div>
<div id="graphing-outliers" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Graphing Outliers</h3>
<p>We will do some more basic exploration regarding our data set, particularly our dependent variable of interest: Earnings the next year. Earnings_next_year_Scaled is the company’s earnings the next year. So Earnings_next_year_Scaled value of 1 for Company X in 2015 can be interpreted as 1 billion dollars in earnings in 2016.</p>
<p>We explore Earnings next year below:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Graphing Outliers</span></span>
<span id="cb3-2"><a href="data.html#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Earnings_next_year_Scaled)) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="data.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data.html#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> EARNINGS_Scaled, <span class="at">y=</span> Earnings_next_year_Scaled))<span class="sc">+</span></span>
<span id="cb4-2"><a href="data.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<p>There is a high number of outliers in our data, this is not ideal as we do not want to fit a model that includes outliers as predicting and modeling posterior distributions would be hard in the grand scheme.</p>
<p>We removed outliers by classifying them as one if they are outside the range of +/- (0.9 * IQR) (Interquartile Range).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data.html#cb5-1" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data<span class="sc">$</span>Earnings_next_year_Scaled, <span class="at">probs=</span><span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">75</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>iqr <span class="ot">&lt;-</span> <span class="fu">IQR</span>(data<span class="sc">$</span>Earnings_next_year_Scaled, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="data.html#cb5-3" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span>  Q[<span class="dv">2</span>]<span class="sc">+</span>.<span class="dv">90</span><span class="sc">*</span>iqr <span class="co"># Upper Range  </span></span>
<span id="cb5-4"><a href="data.html#cb5-4" aria-hidden="true" tabindex="-1"></a>low<span class="ot">&lt;-</span> Q[<span class="dv">1</span>]<span class="sc">-</span>.<span class="dv">90</span><span class="sc">*</span>iqr <span class="co"># Lower Range</span></span>
<span id="cb5-5"><a href="data.html#cb5-5" aria-hidden="true" tabindex="-1"></a>eliminated<span class="ot">&lt;-</span> <span class="fu">subset</span>(data, data<span class="sc">$</span>Earnings_next_year_Scaled <span class="sc">&gt;</span> (low) <span class="sc">&amp;</span> data<span class="sc">$</span>Earnings_next_year_Scaled <span class="sc">&lt;</span> (up))</span>
<span id="cb5-6"><a href="data.html#cb5-6" aria-hidden="true" tabindex="-1"></a>data_elimatedO <span class="ot">&lt;-</span> eliminated</span></code></pre></div>
<p>We graph the data points without outliers below:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data.html#cb6-1" aria-hidden="true" tabindex="-1"></a>data_elimatedO <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Earnings_next_year_Scaled)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="data.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>data_elimatedO <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> EARNINGS_Scaled, <span class="at">y=</span> Earnings_next_year_Scaled))<span class="sc">+</span></span>
<span id="cb7-2"><a href="data.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
<p>This is much better as the data points are closer in proximity.</p>
</div>
</div>
<div id="initial-explorations" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Initial Explorations</h2>
<p>After collecting the data, we then looked for the distribution of the companies within the S&amp;P 500. The first plot we are going to create is the number of companies within the period:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tabyl</span>(data<span class="sc">$</span>YEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="data.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> <span class="st">`</span><span class="at">data$YEAR</span><span class="st">`</span>, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="data.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="data.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of Companies Within the Period&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span> </span>
<span id="cb8-5"><a href="data.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>As we see above, we have data for about 70% of the companies in the S&amp;P 500 for the first year of our data, and by 2021 we have about every single company within the index. It is important for us to have data on as many companies as possible over this time period so that we can better capture trends and make more accurate models based on the data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data.html#cb9-1" aria-hidden="true" tabindex="-1"></a>sumUSA <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="data.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="data.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sumMarket_cap =</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">MARKET.CAP</span><span class="st">`</span>), </span>
<span id="cb9-4"><a href="data.html#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sumEarnings =</span> <span class="fu">sum</span>(EARNINGS), </span>
<span id="cb9-5"><a href="data.html#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sumSALES =</span> <span class="fu">sum</span>(SALES), </span>
<span id="cb9-6"><a href="data.html#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sumCASH =</span> <span class="fu">sum</span>(CASH)) </span>
<span id="cb9-7"><a href="data.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="data.html#cb9-8" aria-hidden="true" tabindex="-1"></a>sumUSA <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="data.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> YEAR, <span class="at">y =</span> sumMarket_cap)) <span class="sc">+</span> </span>
<span id="cb9-10"><a href="data.html#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb9-11"><a href="data.html#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb9-12"><a href="data.html#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sum of Market Cap&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Market Cap within Dataset&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Next, we investigated how market cap, specifically the sum of all the companies’ market caps, varied from year to year. By grouping by year, we were able to easily combine each companies market cap together to create the plot above. This plot highlights trends in the overall market, we see a general increase over time in market cap, with sharp decreases around 2008 and 2020. Those two years align with the housing market crash and COVID respectively, both which led to decreases in the stock market. By identifying trends in the overall market, we may have a better idea about how individual companies may perform.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data.html#cb10-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="data.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(COMPANY) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="data.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), </span>
<span id="cb10-4"><a href="data.html#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_MC =</span> <span class="fu">mean</span>(MARKET.CAP)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="data.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">==</span> <span class="dv">23</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="data.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_MC)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="data.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">50</span>)</span>
<span id="cb10-8"><a href="data.html#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="data.html#cb10-9" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> temp<span class="sc">$</span>COMPANY</span>
<span id="cb10-10"><a href="data.html#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="data.html#cb10-11" aria-hidden="true" tabindex="-1"></a>data_2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span>  </span>
<span id="cb10-12"><a href="data.html#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COMPANY <span class="sc">%in%</span> temp) </span>
<span id="cb10-13"><a href="data.html#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="data.html#cb10-14" aria-hidden="true" tabindex="-1"></a>data_2 <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="data.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> EARNINGS, <span class="at">x=</span> SALES, <span class="at">color =</span> Sector))<span class="sc">+</span></span>
<span id="cb10-16"><a href="data.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.20</span>)<span class="sc">+</span></span>
<span id="cb10-17"><a href="data.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)<span class="sc">+</span></span>
<span id="cb10-18"><a href="data.html#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb10-19"><a href="data.html#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Sales and Earnings Relationship by Sector </span><span class="sc">\n</span><span class="st"> Among top 50 Companies by Market Cap&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Our main objective with this project is to be able to accurately predict future earnings using metrics like sales, previous earnings, and other variables like the sector of the company. We found that overall, among the top 50 companies (based on market cap), there were positive relationships between earning and sales. This relationship varies based on the market sector, with IT having the most positive relationship, and Consumer Staples having the least positive relationship. This indicates to us that both sector and sales may be important predictors of earnings that we should explore using in our future models.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data.html#cb11-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="data.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Earnings_next_year_Scaled, <span class="at">x=</span> EARNINGS_Scaled, <span class="at">color =</span> Sector))<span class="sc">+</span></span>
<span id="cb11-3"><a href="data.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.20</span>)<span class="sc">+</span></span>
<span id="cb11-4"><a href="data.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)<span class="sc">+</span></span>
<span id="cb11-5"><a href="data.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb11-6"><a href="data.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Same Year&quot;</span>)</span>
<span id="cb11-7"><a href="data.html#cb11-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="data.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Earnings_next_year_Scaled, <span class="at">x=</span> EARNINGS_1_YEAR_AGO, <span class="at">color =</span> Sector))<span class="sc">+</span></span>
<span id="cb11-9"><a href="data.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.20</span>)<span class="sc">+</span></span>
<span id="cb11-10"><a href="data.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)<span class="sc">+</span></span>
<span id="cb11-11"><a href="data.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb11-12"><a href="data.html#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;1 year ago&quot;</span>)</span>
<span id="cb11-13"><a href="data.html#cb11-13" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a href="data.html#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Earnings_next_year_Scaled, <span class="at">x=</span> EARNINGS_2_YEAR_AGO, <span class="at">color =</span> Sector))<span class="sc">+</span></span>
<span id="cb11-15"><a href="data.html#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.20</span>)<span class="sc">+</span></span>
<span id="cb11-16"><a href="data.html#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)<span class="sc">+</span></span>
<span id="cb11-17"><a href="data.html#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb11-18"><a href="data.html#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;2 year ago&quot;</span>)</span>
<span id="cb11-19"><a href="data.html#cb11-19" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-20"><a href="data.html#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Earnings_next_year_Scaled, <span class="at">x=</span> EARNINGS_3_YEAR_AGO, <span class="at">color =</span> Sector))<span class="sc">+</span></span>
<span id="cb11-21"><a href="data.html#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.20</span>)<span class="sc">+</span></span>
<span id="cb11-22"><a href="data.html#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)<span class="sc">+</span></span>
<span id="cb11-23"><a href="data.html#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb11-24"><a href="data.html#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;3 year ago&quot;</span>)</span>
<span id="cb11-25"><a href="data.html#cb11-25" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb11-26"><a href="data.html#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Earnings_next_year_Scaled, <span class="at">x=</span> EARNINGS_4_YEAR_AGO, <span class="at">color =</span> Sector))<span class="sc">+</span></span>
<span id="cb11-27"><a href="data.html#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.20</span>)<span class="sc">+</span></span>
<span id="cb11-28"><a href="data.html#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x)<span class="sc">+</span> </span>
<span id="cb11-29"><a href="data.html#cb11-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb11-30"><a href="data.html#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;4 year ago&quot;</span>)</span>
<span id="cb11-31"><a href="data.html#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="data.html#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1, p2, p3, p4, p5,</span>
<span id="cb11-33"><a href="data.html#cb11-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb11-34"><a href="data.html#cb11-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="series_files/figure-html/unnamed-chunk-13-1.png" width="960" /></p>
<p>For most sectors, it appears that the farther back we go, the flatter the relationship between Earnings and past earnings is. If we plot earnings next year with earnings four years ago, we will see that almost all sectors have different slopes.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="hierarchical-modeling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
